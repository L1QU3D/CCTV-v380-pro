#!/usr/bin/python3
from Crypto.Cipher import AES

EXAMPLE_PACKET_HEX = '8f040000f3030000030000000093f5d100323032302d30392d30332031303a32373a33300000000000000000000000000061646d696e0000000000000000000000000000000000000000000000000000003d213634794d22633548227324777961762db58468de3e9a004a1f997caae79e3cf04474b3a78da9e1e977ca424f669900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'

#8f040000f3030000030000000093f5d10031333735393839312e6e766476722e6e657400000000000000000000000000000000000000000000000000000000000000006022000061646d696e000000000000000000000000000000000000000000000000000000645e7c48313c5646253342414a324b47707b9d8224c240d2083ad7f932e03f442e8ffbf824339730228a1d0eed23cf6e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

def decrypt(key, data):
    aes = AES.new(key.encode('utf8'), AES.MODE_ECB)
    unpad = lambda date: date[0:-date[-1]]
    msg = aes.decrypt(data)
    print(f'\u001b[33m[!] Decrypting with key: {key}\u001b[37m')
    print(f'[*] Decrypting data: {data.hex()}')
    print(f'[*] Decrypted data: {unpad(msg).hex()}')
    return unpad(msg)

def decryptPacket(packet):
    print(f'[*] Decrypting packet: {packet.hex()}')
    randomKey2 = packet[81:97].decode('utf-8')
    username = packet[49:81].decode('utf-8')
    origEncryptLenght = 48
    origEncrypted = packet[97:97 + origEncryptLenght]
    # print(repr(origEncrypted)) #debugging
    decrypted = decrypt(randomKey2, origEncrypted)
    finalDecrypted = decrypt('macrovideo+*#!^@', decrypted).decode('utf-8')
    result = [username, finalDecrypted]
    return result

result = decryptPacket(bytes.fromhex(EXAMPLE_PACKET_HEX))
print(f'\u001b[32m[+] Username is: {result[0]}')
print(f'[+] Password is: {result[1]}\u001b[37m')